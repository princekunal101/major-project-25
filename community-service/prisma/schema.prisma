// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model CommunityUser {
  id               String            @id @default(uuid())
  userId           String            @unique
  isAllowed        Boolean           @default(false)
  isPremium        Boolean           @default(false)
  updatedAt        DateTime          @updatedAt
  createdAt        DateTime          @default(now())
  adminCommunities Community[]       @relation("CommunityAdmins")
  communities      Community[]
  communityMembers CommunityMember[]

  @@map("community_users")
}

model Community {
  id               String            @id @default(uuid())
  displayName      String
  communityName    String            @unique
  description      String?
  guideline        String?
  communityType    CommunityTypes    @default(PUBLIC)
  communityTopic   CommunityTopics   @default(IDENTITY)
  keywords         String[]
  sharedValue      SharedValue       @default(KNOWLEDGE_SHARING)
  creator          CommunityUser     @relation(fields: [createdBy], references: [userId])
  createdBy        String
  displayPicUrl    String?
  bannerPicUrl     String?
  isVerified       Boolean           @default(false)
  updatedAt        DateTime          @updatedAt
  createdAt        DateTime          @default(now())
  admins           CommunityUser[]   @relation("CommunityAdmins")
  communityMembers CommunityMember[]

  @@index([createdBy])
  @@map("communities")
}

model CommunityMember {
  id             String        @id @default(uuid())
  communityUsers CommunityUser @relation(fields: [userId], references: [userId])
  userId         String
  community      Community     @relation(fields: [communityId], references: [id])
  communityId    String
  status         MemberStatus  @default(PENDING)
  updatedAt      DateTime      @updatedAt
  createdAt      DateTime      @default(now())

  @@unique([userId, communityId])
  @@map("community_members")
}

enum MemberStatus {
  PENDING // request sent (only_for_private)
  ACCEPTED // follow accepted
  REJECTED // request denied
}

enum CommunityTypes {
  PRIVATE // only member can interact with community and need to take permission to enter it
  PUBLIC // all can be access and can post
  RESTRICTED // only admin can post 
}

enum CommunityTopics {
  TOPIC // e.g. "Photography", "Fitness"
  BRAND // e.g. "Nike", "Apple"
  CREATOR // e.g. "YouTuber", "Writer"
  MOVEMEMT // e.g. "Open Source", "Minimalism"
  CAUSE // e.g. "Climate Actions", "Animal Rights"
  IDENTITY // e.g. "Students", "Teachers", "Gamers"
}

enum SharedValue {
  KNOWLEDGE_SHARING
  ACTIVISM
  ENTERTAINMENT
  CREATIVITY
  INNOVATION
  SUPPORT
}
